"""
–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ç–µ—Å—Ç–∏ —Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏ –æ–±–æ—Ö –∑–∞–≤–¥–∞–Ω—å
"""

print("=" * 80)
print("–î–û–ú–ê–®–ù–Ñ –ó–ê–í–î–ê–ù–ù–Ø: –ê–ª–≥–æ—Ä–∏—Ç–º–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å–∞–º–∏")
print("=" * 80)

# ============================================================================
# –ó–ê–í–î–ê–ù–ù–Ø 1: LRU-–ö–ï–®
# ============================================================================
print("\n" + "=" * 80)
print("–ó–ê–í–î–ê–ù–ù–Ø 1: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é LRU-–∫–µ—à—É")
print("=" * 80)

from task1_lru_cache import LRUCache, make_queries, test_with_cache, test_without_cache
import random

# –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ LRUCache
print("\n[–¢–µ—Å—Ç 1] –ë–∞–∑–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ LRUCache")
print("-" * 80)

cache = LRUCache(capacity=3)
print("–°—Ç–≤–æ—Ä–µ–Ω–æ –∫–µ—à –∑ —î–º–Ω—ñ—Å—Ç—é 3")

# –î–æ–¥–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏
cache.put((0, 10), 100)
print("–î–æ–¥–∞–Ω–æ: –¥—ñ–∞–ø–∞–∑–æ–Ω (0, 10) -> —Å—É–º–∞ 100")
cache.put((5, 15), 200)
print("–î–æ–¥–∞–Ω–æ: –¥—ñ–∞–ø–∞–∑–æ–Ω (5, 15) -> —Å—É–º–∞ 200")
cache.put((10, 20), 300)
print("–î–æ–¥–∞–Ω–æ: –¥—ñ–∞–ø–∞–∑–æ–Ω (10, 20) -> —Å—É–º–∞ 300")

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
result = cache.get((0, 10))
print(f"–û—Ç—Ä–∏–º–∞–Ω–æ –¥—ñ–∞–ø–∞–∑–æ–Ω (0, 10): {result}")

# –î–æ–¥–∞—î–º–æ —â–µ –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç (–º–∞—î –≤–∏–¥–∞–ª–∏—Ç–∏ –Ω–∞–π–º–µ–Ω—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏–π)
cache.put((20, 30), 400)
print("–î–æ–¥–∞–Ω–æ: –¥—ñ–∞–ø–∞–∑–æ–Ω (20, 30) -> —Å—É–º–∞ 400")

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —â–æ (5, 15) –±—É–ª–æ –≤–∏–¥–∞–ª–µ–Ω–æ (LRU)
result = cache.get((5, 15))
print(f"–°–ø—Ä–æ–±–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ (5, 15): {result} (–º–∞—î –±—É—Ç–∏ -1, –±–æ –≤–∏–¥–∞–ª–µ–Ω–æ)")

# –¢–µ—Å—Ç 2: –Ü–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–µ—à—É
print("\n[–¢–µ—Å—Ç 2] –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∫–µ—à—É –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ")
print("-" * 80)

cache = LRUCache(capacity=10)
cache.put((0, 10), 100)
cache.put((5, 15), 200)
cache.put((20, 30), 300)
print("–î–æ–¥–∞–Ω–æ 3 –¥—ñ–∞–ø–∞–∑–æ–Ω–∏: (0,10), (5,15), (20,30)")

cache.invalidate_range(7)
print("–Ü–Ω–≤–∞–ª—ñ–¥–æ–≤–∞–Ω–æ –≤—Å—ñ –¥—ñ–∞–ø–∞–∑–æ–Ω–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å —ñ–Ω–¥–µ–∫—Å 7")

print(f"–î—ñ–∞–ø–∞–∑–æ–Ω (0, 10) –ø—ñ—Å–ª—è —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó: {cache.get((0, 10))} (–º–∞—î –±—É—Ç–∏ -1)")
print(f"–î—ñ–∞–ø–∞–∑–æ–Ω (5, 15) –ø—ñ—Å–ª—è —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó: {cache.get((5, 15))} (–º–∞—î –±—É—Ç–∏ -1)")
print(f"–î—ñ–∞–ø–∞–∑–æ–Ω (20, 30) –ø—ñ—Å–ª—è —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó: {cache.get((20, 30))} (–º–∞—î –±—É—Ç–∏ 300)")

# –¢–µ—Å—Ç 3: –®–≤–∏–¥–∫–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
print("\n[–¢–µ—Å—Ç 3] –®–≤–∏–¥–∫–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (–º–∞–ª–∏–π —Ç–µ—Å—Ç)")
print("-" * 80)

n = 10_000
q = 5_000
print(f"–†–æ–∑–º—ñ—Ä –º–∞—Å–∏–≤—É: {n:,}, –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤: {q:,}")

array = [random.randint(1, 100) for _ in range(n)]
queries = make_queries(n, q)

time_no_cache = test_without_cache(array, queries)
time_with_cache = test_with_cache(array, queries)

print(f"–ë–µ–∑ –∫–µ—à—É: {time_no_cache:.3f} —Å")
print(f"–ó –∫–µ—à–µ–º: {time_with_cache:.3f} —Å")
print(f"–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è: √ó{time_no_cache/time_with_cache:.2f}")

# ============================================================================
# –ó–ê–í–î–ê–ù–ù–Ø 2: RATE LIMITER
# ============================================================================
print("\n\n" + "=" * 80)
print("–ó–ê–í–î–ê–ù–ù–Ø 2: Rate Limiter –∑ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º Sliding Window")
print("=" * 80)

from task2_rate_limiter import SlidingWindowRateLimiter
import time

# –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
print("\n[–¢–µ—Å—Ç 1] –ë–∞–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å Rate Limiter")
print("-" * 80)

limiter = SlidingWindowRateLimiter(window_size=5, max_requests=2)
print("–°—Ç–≤–æ—Ä–µ–Ω–æ limiter: –≤—ñ–∫–Ω–æ 5 —Å–µ–∫, –º–∞–∫—Å–∏–º—É–º 2 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è\n")

user = "user1"

# –ü–µ—Ä—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
result1 = limiter.record_message(user)
print(f"1. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 1: {'‚úì –î–æ–∑–≤–æ–ª–µ–Ω–æ' if result1 else '√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ'}")

# –î—Ä—É–≥–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
result2 = limiter.record_message(user)
print(f"2. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 2: {'‚úì –î–æ–∑–≤–æ–ª–µ–Ω–æ' if result2 else '√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ'}")

# –¢—Ä–µ—Ç—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–º–∞—î –±—É—Ç–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ)
result3 = limiter.record_message(user)
wait_time = limiter.time_until_next_allowed(user)
print(f"3. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 3: {'‚úì –î–æ–∑–≤–æ–ª–µ–Ω–æ' if result3 else f'√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")

# –¢–µ—Å—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –≤—ñ–∫–Ω–∞
print("\n[–¢–µ—Å—Ç 2] –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –≤—ñ–∫–Ω–∞ –ø—ñ—Å–ª—è –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —á–∞—Å—É")
print("-" * 80)

limiter = SlidingWindowRateLimiter(window_size=2, max_requests=1)
print("–°—Ç–≤–æ—Ä–µ–Ω–æ limiter: –≤—ñ–∫–Ω–æ 2 —Å–µ–∫, –º–∞–∫—Å–∏–º—É–º 1 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è\n")

user = "user2"

print("1. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–µ—Ä—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...")
result1 = limiter.record_message(user)
print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úì –î–æ–∑–≤–æ–ª–µ–Ω–æ' if result1 else '√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ'}")

print("2. –°–ø—Ä–æ–±–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –¥—Ä—É–≥–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –æ–¥—Ä–∞–∑—É...")
result2 = limiter.record_message(user)
wait_time = limiter.time_until_next_allowed(user)
print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úì –î–æ–∑–≤–æ–ª–µ–Ω–æ' if result2 else f'√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")

print("3. –ß–µ–∫–∞—î–º–æ 2.5 —Å–µ–∫—É–Ω–¥–∏...")
time.sleep(2.5)

print("4. –°–ø—Ä–æ–±–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è...")
result3 = limiter.record_message(user)
print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úì –î–æ–∑–≤–æ–ª–µ–Ω–æ' if result3 else '√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ'}")

# –¢–µ—Å—Ç 3: –ë–∞–≥–∞—Ç–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
print("\n[–¢–µ—Å—Ç 3] –†–æ–±–æ—Ç–∞ –∑ –±–∞–≥–∞—Ç—å–º–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ")
print("-" * 80)

limiter = SlidingWindowRateLimiter(window_size=10, max_requests=1)
print("–°—Ç–≤–æ—Ä–µ–Ω–æ limiter: –≤—ñ–∫–Ω–æ 10 —Å–µ–∫, –º–∞–∫—Å–∏–º—É–º 1 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è\n")

users = ["Alice", "Bob", "Charlie"]

for user in users:
    result = limiter.record_message(user)
    print(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user:8s}: {'‚úì –ü–µ—Ä—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª–µ–Ω–æ' if result else '√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ'}")

print("\n–°–ø—Ä–æ–±–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:")
for user in users:
    result = limiter.record_message(user)
    wait_time = limiter.time_until_next_allowed(user)
    print(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user:8s}: {'‚úì –î–æ–∑–≤–æ–ª–µ–Ω–æ' if result else f'√ó –í—ñ–¥—Ö–∏–ª–µ–Ω–æ (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")

# ============================================================================
# –í–ò–°–ù–û–í–ö–ò
# ============================================================================
print("\n\n" + "=" * 80)
print("–í–ò–°–ù–û–í–ö–ò")
print("=" * 80)

print("""
–ó–ê–í–î–ê–ù–ù–Ø 1 - LRU-–ö–ï–®:
‚úì –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π LRU-–∫–µ—à –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
‚úì –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø–æ–∫–∞–∑—É—î –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –≤ 2-3 —Ä–∞–∑–∏ –Ω–∞ ¬´–≥–∞—Ä—è—á–∏—Ö¬ª –∑–∞–ø–∏—Ç–∞—Ö
‚úì –ö–µ—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–ø—É–ª—è—Ä–Ω—ñ –¥—ñ–∞–ø–∞–∑–æ–Ω–∏ —ñ –≤–∏–¥–∞–ª—è—î –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ
‚úì –Ü–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –º–∞—Å–∏–≤—É

–ó–ê–í–î–ê–ù–ù–Ø 2 - RATE LIMITER:
‚úì –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ Sliding Window Rate Limiter –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
‚úì –ê–ª–≥–æ—Ä–∏—Ç–º —Ç–æ—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î —á–∞—Å–æ–≤—ñ –≤—ñ–∫–Ω–∞ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
‚úì –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –æ–ø—Ç–∏–º—ñ–∑—É—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
‚úì –°–∏—Å—Ç–µ–º–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∑–∞–ø–æ–±—ñ–≥–∞—î —Å–ø–∞–º—É, –æ–±–º–µ–∂—É—é—á–∏ —á–∞—Å—Ç–æ—Ç—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

–û–±–∏–¥–≤–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –≥–æ—Ç–æ–≤—ñ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ä–µ–∞–ª—å–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö! üöÄ
""")

print("=" * 80)
